## ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ íŒŒë“œì˜ ì»¨í…Œì´ë„ˆë¥¼ ìœ ì§€í•  ìˆ˜ ìˆëŠ” ì´ìœ 

- ê·¸ê²ƒì€ ë°”ë¡œ ì»¨í…Œì´ë„ˆë¥¼ `íŒŒë“œ`ë¡œ `ì¶”ìƒí™”` í–ˆê¸° ë•Œë¬¸
- íŒŒë“œì— ì´ìƒì´ ì—†ìœ¼ë‹ˆ ìƒˆë¡œìš´ ì»¨í…Œì´ë„ˆë¥¼ ì¶”ê°€ â†’ ìê¸°ìˆ˜ë³µì„±
- ê·¸ ìœ„ì— ë””í”Œë¡œì´ë¨¼íŠ¸ë¡œ ì¶”ìƒí™”â†’ ë…¸ë“œê°€ ê³ ì¥ë‚˜ë©´ ë‹¤ë¥¸ë…¸ë“œì— íŒŒë“œë¥¼ ì‹¤í–‰

## ë ˆì´ë¸”ì— ëŒ€í•œ ì´í•´

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/19f14110-c29c-496f-9b95-062969c86b08/3ee84f8a-9f34-4878-a563-97404663be83/Untitled.png)

â†’ íŒŒë“œì˜ ë ˆì´ë¸” ì •ë³´ë¥¼ ìˆ˜ì •í•˜ë©´ í•´ë‹¹ íŒŒë“œê°€ ì‚¬ë¼ì§„ë‹¤

## Port Forward

`kubectl port-forward deploy/nginx-deploy 8000:80`

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/19f14110-c29c-496f-9b95-062969c86b08/f8c9cea1-e1d0-400b-9e2e-62f8aa151234/Untitled.png)

- ë””í”Œë¡œì´ë¨¼íŠ¸ì— port forwardë¥¼ í•˜ë©´ ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ì„ íŒŒë“œë¡œ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤.

---

# ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì„œë¹„ìŠ¤ì— íŒŒë“œ ì—°ê²°í•˜ê¸°

- íŒŒë“œëŠ” ëŒ€ì²´ë  ë•Œ ì£¼ì†Œê°€ ë³€ê²½ëœë‹¤. â†’ ì„œë¹„ìŠ¤ë¥¼ ì¨ì•¼í•¨

<aside>
âšª kubectl apply `-f` sleep/sleep1.yaml `-f` sleep/sleep2. yaml

- ì—¬ê¸°ì„œ -f ì˜µì…˜ì€ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ì„ ì§€ì •í•˜ëŠ”ë° ì‚¬ìš©
</aside>

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/19f14110-c29c-496f-9b95-062969c86b08/54ab8c5c-1f0e-40af-af9a-6d97d061daf4/Untitled.png)

- ì„œë¹„ìŠ¤ëŠ” íŒŒë“œì™€ íŒŒë“œê°€ ê°€ì§„ ë„¤íŠ¸ì›Œí¬ ì£¼ì†Œë¥¼ ì¶”ìƒí™” í•œ ê²ƒ
- ìì‹ ë§Œì˜ IP ì£¼ì†Œë¥¼ ê°–ëŠ”ë‹¤.
- ì„œë¹„ìŠ¤-íŒŒë“œ ê°„ì˜ ê´€ê³„ëŠ” ë ˆì´ë¸” ì»¬ë ‰í„°ë¥¼ ì‚¬ìš©

## sleep2-service.yaml

```yaml
apiVersion: v1
kind: Service
metadata:
  name: sleep-2 # ë„ë©”ì¸ ë„¤ì„
spec: # ì…€ë ˆê²‰ì™€ í¬íŠ¸ê°€ í¬í•¨
  selector:
    app: sleep-2
  ports:
    - port: 80
```

# íŒŒë“œì™€ íŒŒë“œê°„ í†µì‹ 

- í´ëŸ¬ìŠ¤í„°IP: ì„œë¹„ìŠ¤ ìœ í˜• ì¤‘ í•˜ë‚˜ë¡œ í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ í†µìš©ë˜ëŠ” IPì£¼ì†Œ â†’ íŒŒë“œì™€ íŒŒë“œ ê°„ í†µì‹ 

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/19f14110-c29c-496f-9b95-062969c86b08/afeb2eb5-1a13-4f6b-946c-9c91c158c2af/Untitled.png)

- ì•„ì§ ì„œë¹„ìŠ¤ê°€ ì—†ê¸° ë•Œë¬¸ì— APIì— ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤.
- ë„ë©”ì¸ ì´ë¦„ì€ numbers-api ì´ë‹¤. ì„œë¹„ìŠ¤ë¥¼ í†µí•´ì„œ ì´ë¥¼ ì¿ ë²„ë„¤í‹°ìŠ¤ ë‚´ë¶€ DNS ì„œë²„ì— ë“±ë¡í•´ì•¼ ëœë‹¤.

```yaml
apiVersion: v1
kind: Service
metadata:
  name: numbers-api  # ë„ë©”ì¸ ë„¤ì„
spec: # ì…€ë ‰í„°ì™€ í¬íŠ¸ê°€ í¬í•¨
	ports:
		- port: 80
  selector:
    app: numbers-api 
	type: ClusterIp
```

```yaml
leehyunje@ihyeonje-ui-MacBookAir ch03 % kubectl get svc numbers-api
NAME          TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE
numbers-api   ClusterIP   10.104.159.42   <none>        80/TCP    120m
```

- â†’ ìƒì„±í•´ë„.. ì•ˆëœë‹¤..? ì™œì§€â€¦

<aside>
âšª **curl ì´ë¯¸ì§€ ê¸°ë°˜ì˜ ì„ì‹œ íŒŒë“œë¥¼ ìƒì„±í•˜ê³  ë°”ë¡œ shellì— ì ‘ì†**

`kubectl run curl --image=curlimages/curl --restart=Never --rm -it -- sh`

</aside>

## ì™¸ë¶€ íŠ¸ë˜í”½ì„ íŒŒë“œë¡œ ì „ë‹¬í•˜ê¸°

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/19f14110-c29c-496f-9b95-062969c86b08/f1074ce7-9492-4c77-8ab6-0fe6e4f2123c/Untitled.png)

### ë¡œë“œë°¸ëŸ°ì„œ: ì™¸ë¶€ì—ì„œ ë“¤ì–´ì˜¤ëŠ” íŠ¸ë˜í”½ì„ íŒŒë“œì—ê²Œ ì „ë‹¬í•œë‹¤.

ë¡œë“œ ë°¸ëŸ°ì„œ ì„œë¹„ìŠ¤ ë°°í¬

`kubectl apply -f numbers/web-service.yaml`

```yaml
leehyunje@ihyeonje-ui-MacBookAir ch03 % kubectl get svc numbers-web
NAME          TYPE           CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE
numbers-web   LoadBalancer   10.103.77.50   <pending>     8080:32002/TCP   3m19s
```

- minikubeì™€ ê°™ì€ ë¡œì»¬ ê°œë°œ í™˜ê²½ì—ì„œëŠ” LoadBalancer íƒ€ì…ì˜ ì„œë¹„ìŠ¤ê°€ ì™„ì „íˆ ì§€ì›ë˜ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ minukube service [service-name] â€”url ëª…ë ¹ì„ í†µí•´ì„œ ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•´ì•¼ ëœë‹¤.

```yaml
leehyunje@ihyeonje-ui-MacBookAir ch03 % minikube service numbers-web --url
http://127.0.0.1:57885
```

- ì•„ë‹ˆë©´ í„°ë„ì„ ì‹¤í–‰í•˜ê³  ë‹¤ë¥¸ í„°ë¯¸ë„ì—ì„œ ì ‘ì†í•œë‹¤.

```yaml
leehyunje@ihyeonje-ui-MacBookAir ch03 % minikube tunnel
\âœ…  Tunnel successfully started

ğŸ“Œ  NOTE: Please do not close this terminal as this process must stay alive for the tunnel to be accessible ...

ğŸƒ  numbers-web ì„œë¹„ìŠ¤ì˜ í„°ë„ì„ ì‹œì‘í•˜ëŠ” ì¤‘

leehyunje@ihyeonje-ui-MacBookAir ch03 % kubectl get svc numbers-web 
NAME          TYPE           CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE
numbers-web   LoadBalancer   10.103.77.50   127.0.0.1     8080:32002/TCP   25m
```

- ìœ„ ì²˜ëŸ¼ external-ipê°€ ìƒì„±ë˜ê³  ì ‘ì†ê¹Œì§€ ì›í™œí•˜ê²Œ ëœë‹¤.

<aside>
âšª **`minikube tunnel` ëª…ë ¹ì–´ëŠ” minikube í™˜ê²½ì—ì„œ LoadBalancer íƒ€ì…ì˜ ì„œë¹„ìŠ¤ë¥¼ ì™¸ë¶€ë¡œ ë…¸ì¶œì‹œí‚¤ê¸° ìœ„í•œ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.**

</aside>

### ë…¸ë“œí¬íŠ¸: ë¡œë“œë°¸ëŸ°ì„œì™€ ë¹„ìŠ·í•˜ë‚˜, ë¡œë“œë°¸ëŸ°ì„œê°€ í•„ìš” ì—†ë‹¤.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/19f14110-c29c-496f-9b95-062969c86b08/dabde591-7fab-431c-8478-cba388c5b315/Untitled.png)

- ì„¤ì •ëœ í¬íŠ¸ê°€ ëª¨ë“  ë…¸ë“œì—ì„œ ê°œë°©ë˜ì–´ ìˆì–´ì•¼ í•˜ê³ , ë‹¤ì¤‘ ë…¸ë“œ í´ëŸ¬ìŠ¤í„°ì—ì„œëŠ” ë¡œë“œë°¸ëŸ°ì‹± íš¨ê³¼ë¥¼ ì–»ì„ ìˆ˜ ì—†ëŠ” ë‹¨ì ì´ ìˆìŒ
- ì‹¤ì œ ì‚¬ìš©í•  ì¼ì´ ë³„ë¡œ ì—†ë‹¤ê³  í•œë‹¤. ë¡œë“œë°¸ëŸ°ì„œ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©´ ê°œë°œ í™˜ê²½ë¶€í„° ìš´ì˜í™˜ê²½ê¹Œì§€ ì• í”Œë¦¬ì¼€ì´ì…˜ ì •ì˜ë¥¼ ìœ ì§€ê°€ëŠ¥.

## ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ì™¸ë¶€ë¡œ íŠ¸ë˜í”½ ì „ë‹¬í•˜ê¸°

- ì™¸ë¶€ì— ë™ì‘í•˜ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ë„ ì—°ë™ì´ ê°€ëŠ¥

### ìµìŠ¤í„°ë„ë„¤ì„ ì„œë¹„ìŠ¤

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/19f14110-c29c-496f-9b95-062969c86b08/77faea95-6819-4697-9b36-b5e17094b9c1/Untitled.png)

- ì–´ë–¤ ë„ë©”ì¸ ë„¤ì„ì— ëŒ€í•œ ë³„ëª…
- ì• í”Œë¦¬ì¼€ì´ì…˜ íŒŒë“œì—ì„œ ë¡œì»¬ ë„¤ì„ì„ ì‚¬ìš© â†’ ì¿ ë²„ë„¤í‹°ìŠ¤ DNSì„œë²„ì— ì¡°íšŒí•˜ë©´ ì™¸ë¶€ ë„ë©”ì¸ìœ¼ë¡œ ì—°ê²°
- `kubectl apply -f numbers-services/api-service-headless.yaml`

```yaml
apiVersion: v1
kind: Service
metadata:
  name: numbers-api #í´ëŸ¬ìŠ¤í„° ì•ˆì— ì“°ì´ëŠ” ë¡œì»¬ ë„ë©”ì¸
spec:
  type: ExternalName
  externalName: raw.githubusercontent.com #ì™¸ë¶€ ë„ë©”ì¸
```

```yaml
NAME          TYPE           CLUSTER-IP   EXTERNAL-IP                 PORT(S)   AGE
kubernetes    ClusterIP      10.96.0.1    <none>                      443/TCP   44h
numbers-api   ExternalName   <none>       raw.githubusercontent.com   <none>    6s
```

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/19f14110-c29c-496f-9b95-062969c86b08/72951571-dc43-4d6b-9b4e-15ac93ce97ba/Untitled.png)

- í•´ë‹¹ external-ipì˜ ì •ì ì¸ í…ìŠ¤íŠ¸ íŒŒì¼ì„ ë³´ì—¬ì¤Œ
- íŒŒë“œê°€ numbers-apië¥¼ ì¡°íšŒí•˜ë©´, ì¿ ë²„ë„¤í‹°ìŠ¤ DNSê°€ CNAME(ì—¬ê¸°ì„œëŠ” raw.githubusercontent .com)ì„ ë°˜í™˜

### í—¤ë“œë¦¬ìŠ¤ ì„œë¹„ìŠ¤

- ë„ë©”ì¸ ë„¤ì„ ëŒ€ì‹  IP ì£¼ì†Œë¥¼ ëŒ€ì²´í•´ì£¼ëŠ” ì„œë¹„ìŠ¤
- ì…€ë ‰í„°ê°€ ì—†ê¸° ë•Œë¬¸ì— ëŒ€ìƒ íŒŒë“œê°€ ì—†ë‹¤.
- ì—”ë“œí¬ì¸íŠ¸ ë¦¬ì†ŒìŠ¤ì™€ í•¨ê»˜ ë°°í¬
- `kubectl apply -f numbers-services/api-service-headless.yaml`

```yaml
apiVersion: v1
kind: Service
metadata:
  name: numbers-api
spec:
  type: ClusterIP
  ports:
    - port: 80
---
kind: Endpoints
apiVersion: v1
metadata:
  name: numbers-api
subsets:
  - addresses: # ì •ì  IP ì£¼ì†Œ ëª©ë¡
      - ip: 192.168.123.234
    ports:
      - port: 80
```

NAME          TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE
numbers-api   ClusterIP   10.98.51.176   <none>        80/TCP    4s

```yaml
leehyunje@ihyeonje-ui-MacBookAir ch03 % kubectl get endpoints numbers-api
NAME          ENDPOINTS            AGE
numbers-api   192.168.123.234:80   48s
```

## ì¿ ë²„ë„¤í‹°ìŠ¤ ì„œë¹„ìŠ¤ì˜ í•´ì†Œ ê³¼ì •

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/19f14110-c29c-496f-9b95-062969c86b08/dc7a8a1f-776b-4912-9b9d-99e995cfd0f7/Untitled.png)

- íŒŒë“œ â†’ ë„¤íŠ¸ì›Œí¬ í”„ë¡ì‹œë¡œ ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼
- í”„ë¡ì‹œëŠ” íŒ¨í‚· í•„í„°ë§ìœ¼ë¡œ ê°€ìƒ IP ì£¼ì†Œë¥¼ ì‹¤ì œ ì—”ë“œí¬ì¸íŠ¸ë¡œ ì—°ê²°
- ì„œë¹„ìŠ¤ì—ë„ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ìˆê³ , íŒŒë“œê°€ ë³€ê²½ë  ë•Œ ìµœì‹  ì—”ë“œí¬ì¸íŠ¸ë¥¼ ê°±ì‹ 

```yaml
leehyunje@ihyeonje-ui-MacBookAir sleep % kubectl get endpoints sleep-2       
NAME      ENDPOINTS       AGE
sleep-2   10.244.1.3:80   5s 
leehyunje@ihyeonje-ui-MacBookAir sleep % kubectl delete pods -l app=sleep-2
pod "sleep-2-789c9f5fb8-wtbm6" deleted
leehyunje@ihyeonje-ui-MacBookAir sleep % kubectl get endpoints sleep-2     
NAME      ENDPOINTS       AGE
sleep-2   10.244.1.4:80   56s
```

- íŒŒë“œê°€ ì‚­ì œë˜ë©´ ë””í”Œë¡œì´ë¨¼íŠ¸ê°€ ìƒˆë¡œìš´ íŒŒë“œë¥¼ ë§Œë“¤ê³  ì—”ë“œ í¬ì¸íŠ¸ëŠ” ìƒˆë¡­ê²Œ ì—…ë°ì´íŠ¸ ëœë‹¤.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/19f14110-c29c-496f-9b95-062969c86b08/973e5807-8afe-4781-89e7-22f5d083f71f/Untitled.png)

- ë‹¤ë¥¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ìˆëŠ” íŒŒë“œëŠ” ì™„ì „í•œ ë„ì—ë¯¼ ë„¤ì„ìœ¼ë¡œ ë‹¤ë¥¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ì ‘ê·¼ ê°€ëŠ¥
